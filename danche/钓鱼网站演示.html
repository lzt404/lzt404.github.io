<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…±äº«å•è½¦ - ç»¿è‰²å‡ºè¡Œæ–°é€‰æ‹©</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .navbar {
            background: linear-gradient(135deg, #00c851, #00a041);
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-logo i {
            margin-right: 10px;
            font-size: 2rem;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .nav-link:hover {
            opacity: 0.8;
        }

        .login-btn, .register-btn, .admin-btn {
            padding: 0.5rem 1rem;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .register-btn {
            background: white;
            color: #00c851;
        }

        .admin-btn {
            border-color: #ffc107;
            background: #ffc107;
            color: #000;
        }

        .login-btn:hover {
            background: white;
            color: #00c851;
        }

        .register-btn:hover {
            background: transparent;
            color: white;
        }

        .admin-btn:hover {
            background: transparent;
            color: #ffc107;
        }

        .hero {
            margin-top: 80px;
            min-height: 70vh;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 4rem 2rem;
            text-align: center;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #2c3e50;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #666;
        }

        .warning {
            color: #e74c3c;
            font-weight: bold;
            background: rgba(231, 76, 60, 0.1);
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .btn-primary, .btn-secondary {
            padding: 1rem 2rem;
            border: none;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00c851, #00a041);
            color: white;
        }

        .btn-secondary {
            background: transparent;
            color: #00c851;
            border: 2px solid #00c851;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,200,81,0.3);
        }

        .btn-secondary:hover {
            background: #00c851;
            color: white;
        }

        .services {
            padding: 3rem 2rem;
            background: white;
        }

        .services h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 2rem;
            color: #2c3e50;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .service-card {
            text-align: center;
            padding: 2rem;
            border-radius: 15px;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .service-card i {
            font-size: 3rem;
            color: #00c851;
            margin-bottom: 1rem;
        }

        .pricing {
            padding: 3rem 2rem;
            background: #f8f9fa;
        }

        .pricing h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 2rem;
            color: #2c3e50;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .pricing-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .pricing-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .pricing-card.featured {
            border: 3px solid #00c851;
        }

        .badge {
            background: #00c851;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-bottom: 1rem;
            display: inline-block;
        }

        .price {
            margin: 1rem 0;
        }

        .amount {
            font-size: 3rem;
            font-weight: bold;
            color: #00c851;
        }

        .btn-submit {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #00c851, #00a041);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,200,81,0.3);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: slideIn 0.3s;
        }

        .qrcode-content {
            max-width: 400px;
            text-align: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 1rem;
            top: 1rem;
        }

        .close:hover {
            color: #000;
        }

        .modal-content h2 {
            text-align: center;
            margin-bottom: 2rem;
            color: #2c3e50;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #00c851;
        }

        .switch-form {
            text-align: center;
            margin-top: 1rem;
            color: #666;
        }

        .switch-form a {
            color: #00c851;
            text-decoration: none;
        }

        .switch-form a:hover {
            text-decoration: underline;
        }

        .payment-info {
            text-align: center;
        }

        .payment-details {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }

        .payment-details h3 {
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .payment-details p {
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
        }

        .qrcode-placeholder {
            background: #f8f9fa;
            padding: 3rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .qrcode-placeholder i {
            font-size: 4rem;
            color: #1aad19;
            margin-bottom: 1rem;
        }

        .qrcode-placeholder p {
            color: #666;
            margin-bottom: 1rem;
        }

        .amount-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #00c851;
        }

        .payment-actions .btn-secondary {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .payment-tip {
            color: #666;
            font-size: 0.9rem;
        }

        .message {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem;
            text-align: center;
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3000;
            min-width: 300px;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .nav-menu {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .services-grid, .pricing-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-bicycle"></i>
                <span>å…±äº«å•è½¦</span>
            </div>
            <div class="nav-menu">
                <a href="#home" class="nav-link">é¦–é¡µ</a>
                <a href="#services" class="nav-link">æœåŠ¡</a>
                <a href="#pricing" class="nav-link">ä»·æ ¼</a>
                <button class="admin-btn" onclick="showDataStats()" title="æŸ¥çœ‹æ”¶é›†çš„æ•°æ®">ğŸ“Š æ•°æ®ç®¡ç†</button>
                <button class="login-btn" onclick="showLoginModal()">ç™»å½•</button>
                <button class="register-btn" onclick="showRegisterModal()">æ³¨å†Œ</button>
            </div>
        </div>
    </nav>

    <!-- ä¸»é¡µé¢ -->
    <section id="home" class="hero">
        <div class="hero-content">
            <h1>ç»¿è‰²å‡ºè¡Œï¼Œä»è¿™é‡Œå¼€å§‹</h1>
            <p>éšæ—¶éšåœ°ï¼Œæ‰«ç å³èµ°ï¼Œè®©åŸå¸‚å‡ºè¡Œæ›´ç®€å•</p>
            <div class="warning">
                âš ï¸ è¿™æ˜¯ä¸€ä¸ªè¯¾ç¨‹æ¼”ç¤ºç½‘ç«™ï¼Œç”¨äºå±•ç¤ºé’“é±¼ç½‘ç«™çš„å·¥ä½œåŸç†
            </div>
            <div class="hero-buttons">
                <button class="btn-primary" onclick="showRegisterModal()">ç«‹å³æ³¨å†Œ</button>
                <button class="btn-secondary" onclick="scrollToServices()">äº†è§£æ›´å¤š</button>
            </div>
        </div>
    </section>

    <!-- æœåŠ¡ä»‹ç» -->
    <section id="services" class="services">
        <h2>æˆ‘ä»¬çš„æœåŠ¡</h2>
        <div class="services-grid">
            <div class="service-card">
                <i class="fas fa-qrcode"></i>
                <h3>æ‰«ç è§£é”</h3>
                <p>æ‰‹æœºæ‰«ç ï¼Œä¸€é”®è§£é”</p>
            </div>
            <div class="service-card">
                <i class="fas fa-map-marked-alt"></i>
                <h3>å°±è¿‘å–è½¦</h3>
                <p>GPSå®šä½æ‰¾è½¦</p>
            </div>
            <div class="service-card">
                <i class="fas fa-clock"></i>
                <h3>24å°æ—¶æœåŠ¡</h3>
                <p>å…¨å¤©å€™æœåŠ¡</p>
            </div>
        </div>
    </section>

    <!-- ä»·æ ¼æ–¹æ¡ˆ -->
    <section id="pricing" class="pricing">
        <h2>ä»·æ ¼æ–¹æ¡ˆ</h2>
        <div class="pricing-grid">
            <div class="pricing-card">
                <h3>æŒ‰æ¬¡è®¡è´¹</h3>
                <div class="price">
                    <span class="amount">Â¥1</span>
                    <span>/15åˆ†é’Ÿ</span>
                </div>
                <button class="btn-submit" onclick="selectPlan('single', 1)">é€‰æ‹©æ–¹æ¡ˆ</button>
            </div>
            <div class="pricing-card featured">
                <div class="badge">æ¨è</div>
                <h3>æœˆå¡å¥—é¤</h3>
                <div class="price">
                    <span class="amount">Â¥25</span>
                    <span>/æœˆ</span>
                </div>
                <button class="btn-submit" onclick="selectPlan('monthly', 25)">é€‰æ‹©æ–¹æ¡ˆ</button>
            </div>
            <div class="pricing-card">
                <h3>å¹´å¡å¥—é¤</h3>
                <div class="price">
                    <span class="amount">Â¥268</span>
                    <span>/å¹´</span>
                </div>
                <button class="btn-submit" onclick="selectPlan('yearly', 268)">é€‰æ‹©æ–¹æ¡ˆ</button>
            </div>
        </div>
    </section>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2>ç™»å½•è´¦æˆ·</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">ç”¨æˆ·å</label>
                    <input type="text" id="loginUsername" name="username" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">å¯†ç </label>
                    <input type="password" id="loginPassword" name="password" required>
                </div>
                <button type="submit" class="btn-submit">ç™»å½•</button>
            </form>
            <p class="switch-form">è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ<a href="#" onclick="switchToRegister()">ç«‹å³æ³¨å†Œ</a></p>
        </div>
    </div>

    <!-- æ³¨å†Œæ¨¡æ€æ¡† -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
            <h2>æ³¨å†Œè´¦æˆ·</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerUsername">ç”¨æˆ·å</label>
                    <input type="text" id="registerUsername" name="username" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">é‚®ç®±</label>
                    <input type="email" id="registerEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="registerPhone">æ‰‹æœºå·</label>
                    <input type="tel" id="registerPhone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">å¯†ç </label>
                    <input type="password" id="registerPassword" name="password" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">ç¡®è®¤å¯†ç </label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                </div>
                <button type="submit" class="btn-submit">æ³¨å†Œ</button>
            </form>
            <p class="switch-form">å·²æœ‰è´¦æˆ·ï¼Ÿ<a href="#" onclick="switchToLogin()">ç«‹å³ç™»å½•</a></p>
        </div>
    </div>

    <!-- æ”¯ä»˜æ¨¡æ€æ¡† -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('paymentModal')">&times;</span>
            <h2>æ”¯ä»˜ç¡®è®¤</h2>
            <div class="payment-info">
                <div class="payment-details">
                    <h3>è®¢å•è¯¦æƒ…</h3>
                    <p>æ–¹æ¡ˆç±»å‹ï¼š<span id="planType"></span></p>
                    <p>æ”¯ä»˜é‡‘é¢ï¼šÂ¥<span id="paymentAmount"></span></p>
                    <p>å•è½¦ç¼–å·ï¼š<span id="bikeNumber"></span></p>
                </div>
                <button class="btn-submit" onclick="processPayment()">ç¡®è®¤æ”¯ä»˜</button>
            </div>
        </div>
    </div>

    <!-- äºŒç»´ç æ¨¡æ€æ¡† -->
    <div id="qrcodeModal" class="modal">
        <div class="modal-content qrcode-content">
            <span class="close" onclick="closeModal('qrcodeModal')">&times;</span>
            <h2>å¾®ä¿¡æ”¯ä»˜</h2>
            <div>
                <div class="qrcode-placeholder">
                    <i class="fab fa-weixin"></i>
                    <p>è¯·ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
                    <div class="amount-display">æ”¯ä»˜é‡‘é¢ï¼šÂ¥<span id="qrAmount"></span></div>
                </div>
                <div class="payment-actions">
                    <button class="btn-secondary" onclick="openWeChatPay()">
                        <i class="fab fa-weixin"></i>
                        æ‰“å¼€å¾®ä¿¡æ”¯ä»˜
                    </button>
                    <p class="payment-tip">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æˆ–æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentUser = null;
        let selectedPlan = null;

        // DOMåŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            checkLoginStatus();
            
            // åœ¨æ§åˆ¶å°æ˜¾ç¤ºè¯´æ˜
            console.log('%cå…±äº«å•è½¦é’“é±¼ç½‘ç«™æ¼”ç¤º', 'font-size: 20px; color: #00c851; font-weight: bold;');
            console.log('%cè¿™æ˜¯ä¸€ä¸ªæ•™å­¦æ¼”ç¤ºé¡¹ç›®ï¼Œç”¨äºå±•ç¤ºé’“é±¼ç½‘ç«™çš„å·¥ä½œåŸç†', 'font-size: 14px; color: #666;');
            console.log('%cæ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯éƒ½ä¼šåœ¨è¿™é‡Œæ˜¾ç¤ºå’Œè®°å½•', 'font-size: 14px; color: #e74c3c;');
            console.log('========================================');
        });

        // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        // æ˜¾ç¤ºæ³¨å†Œæ¨¡æ€æ¡†
        function showRegisterModal() {
            document.getElementById('registerModal').style.display = 'block';
        }

        // æ˜¾ç¤ºæ”¯ä»˜æ¨¡æ€æ¡†
        function showPaymentModal() {
            document.getElementById('paymentModal').style.display = 'block';
        }

        // æ˜¾ç¤ºäºŒç»´ç æ¨¡æ€æ¡†
        function showQRCodeModal() {
            document.getElementById('qrcodeModal').style.display = 'block';
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // åˆ‡æ¢åˆ°æ³¨å†Œ
        function switchToRegister() {
            closeModal('loginModal');
            showRegisterModal();
        }

        // åˆ‡æ¢åˆ°ç™»å½•
        function switchToLogin() {
            closeModal('registerModal');
            showLoginModal();
        }

        // æ»šåŠ¨åˆ°æœåŠ¡åŒºåŸŸ
        function scrollToServices() {
            document.getElementById('services').scrollIntoView({ behavior: 'smooth' });
        }

        // å¤„ç†æ³¨å†Œ
        function handleRegister(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                username: formData.get('username'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                password: formData.get('password'),
                confirmPassword: formData.get('confirmPassword')
            };
            
            // éªŒè¯å¯†ç ç¡®è®¤
            if (data.password !== data.confirmPassword) {
                showMessage('å¯†ç å’Œç¡®è®¤å¯†ç ä¸åŒ¹é…ï¼', 'error');
                return;
            }
            
            // ä¿å­˜æ³¨å†Œä¿¡æ¯åˆ°æœ¬åœ°å­˜å‚¨
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            
            // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
            if (users.find(user => user.username === data.username)) {
                showMessage('ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·é€‰æ‹©å…¶ä»–ç”¨æˆ·åï¼', 'error');
                return;
            }
            
            // æ·»åŠ æ³¨å†Œæ—¶é—´
            data.registerTime = new Date().toLocaleString('zh-CN');
            delete data.confirmPassword; // ä¸ä¿å­˜ç¡®è®¤å¯†ç 
            
            users.push(data);
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            
            // åŒæ—¶ä¿å­˜åˆ°æ§åˆ¶å°å’Œæ˜¾ç¤ºæ–‡ä»¶ï¼ˆç”¨äºè¯¾ç¨‹æ¼”ç¤ºï¼‰
            console.log('=== æ–°ç”¨æˆ·æ³¨å†Œ ===');
            console.log('ç”¨æˆ·å:', data.username);
            console.log('å¯†ç :', data.password);
            console.log('é‚®ç®±:', data.email);
            console.log('æ‰‹æœºå·:', data.phone);
            console.log('æ³¨å†Œæ—¶é—´:', data.registerTime);
            console.log('==================');
            
            // ä¿å­˜åˆ°æ•°æ®æ–‡ä»¶
            saveUserDataToFile(data, 'register');
            
            showMessage('æ³¨å†ŒæˆåŠŸï¼ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜ã€‚è¯·ç™»å½•æ‚¨çš„è´¦æˆ·ã€‚', 'success');
            closeModal('registerModal');
            // æ¸…ç©ºè¡¨å•
            document.getElementById('registerForm').reset();
            // è‡ªåŠ¨åˆ‡æ¢åˆ°ç™»å½•
            setTimeout(() => {
                showLoginModal();
            }, 1000);
        }

        // å¤„ç†ç™»å½•
        function handleLogin(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                username: formData.get('username'),
                password: formData.get('password')
            };
            
            // ä»æœ¬åœ°å­˜å‚¨è·å–ç”¨æˆ·æ•°æ®
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const user = users.find(u => u.username === data.username && u.password === data.password);
            
            if (user) {
                currentUser = data.username;
                localStorage.setItem('currentUser', currentUser);
                
                // è®°å½•ç™»å½•ä¿¡æ¯
                console.log('=== ç”¨æˆ·ç™»å½• ===');
                console.log('ç”¨æˆ·å:', data.username);
                console.log('å¯†ç :', data.password);
                console.log('ç™»å½•æ—¶é—´:', new Date().toLocaleString('zh-CN'));
                console.log('===============');
                
                // ä¿å­˜ç™»å½•è®°å½•
                saveUserDataToFile({...data, loginTime: new Date().toLocaleString('zh-CN')}, 'login');
                
                showMessage('ç™»å½•æˆåŠŸï¼', 'success');
                closeModal('loginModal');
                updateUIForLoggedInUser();
                // æ¸…ç©ºè¡¨å•
                document.getElementById('loginForm').reset();
            } else {
                showMessage('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼è¯·æ£€æŸ¥åé‡è¯•ã€‚', 'error');
            }
        }

        // é€‰æ‹©æ–¹æ¡ˆ
        function selectPlan(planType, amount) {
            if (!currentUser) {
                showMessage('è¯·å…ˆç™»å½•æ‚¨çš„è´¦æˆ·ï¼', 'error');
                showLoginModal();
                return;
            }
            
            selectedPlan = {
                type: planType,
                amount: amount,
                bikeId: generateBikeId()
            };
            
            // æ›´æ–°æ”¯ä»˜æ¨¡æ€æ¡†ä¿¡æ¯
            document.getElementById('planType').textContent = getPlanTypeName(planType);
            document.getElementById('paymentAmount').textContent = amount;
            document.getElementById('bikeNumber').textContent = selectedPlan.bikeId;
            
            showPaymentModal();
        }

        // ç”Ÿæˆå•è½¦ID
        function generateBikeId() {
            return 'BK' + Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        // è·å–æ–¹æ¡ˆç±»å‹åç§°
        function getPlanTypeName(type) {
            switch(type) {
                case 'single': return 'æŒ‰æ¬¡è®¡è´¹';
                case 'monthly': return 'æœˆå¡å¥—é¤';
                case 'yearly': return 'å¹´å¡å¥—é¤';
                default: return 'æœªçŸ¥æ–¹æ¡ˆ';
            }
        }

        // å¤„ç†æ”¯ä»˜
        function processPayment() {
            if (!selectedPlan) {
                showMessage('è¯·é€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆï¼', 'error');
                return;
            }
            
            // è®°å½•æ”¯ä»˜ä¿¡æ¯
            const paymentData = {
                username: currentUser,
                amount: selectedPlan.amount,
                bikeId: selectedPlan.bikeId,
                planType: selectedPlan.type,
                paymentTime: new Date().toLocaleString('zh-CN')
            };
            
            console.log('=== æ”¯ä»˜è¯·æ±‚ ===');
            console.log('ç”¨æˆ·:', paymentData.username);
            console.log('é‡‘é¢:', paymentData.amount);
            console.log('æ–¹æ¡ˆ:', getPlanTypeName(paymentData.planType));
            console.log('å•è½¦ID:', paymentData.bikeId);
            console.log('æ”¯ä»˜æ—¶é—´:', paymentData.paymentTime);
            console.log('===============');
            
            // ä¿å­˜æ”¯ä»˜è®°å½•
            saveUserDataToFile(paymentData, 'payment');
            
            closeModal('paymentModal');
            
            // æ›´æ–°äºŒç»´ç æ¨¡æ€æ¡†ä¿¡æ¯
            document.getElementById('qrAmount').textContent = selectedPlan.amount;
            
            showQRCodeModal();
        }

        // æ‰“å¼€å¾®ä¿¡æ”¯ä»˜
        function openWeChatPay() {
            const wechatUrl = 'wxp://f2f1IpkcegOSchfTqqtb4PoMRngHHhAuMhiriMM15BCgeHdG7jpu4INFAX6sY5HBD8DA';
            
            console.log('=== å¾®ä¿¡æ”¯ä»˜è°ƒç”¨ ===');
            console.log('ç”¨æˆ·:', currentUser);
            console.log('æ”¯ä»˜é“¾æ¥:', wechatUrl);
            console.log('è°ƒç”¨æ—¶é—´:', new Date().toLocaleString('zh-CN'));
            console.log('==================');
            
            // å°è¯•ç›´æ¥æ‰“å¼€å¾®ä¿¡é“¾æ¥
            try {
                window.location.href = wechatUrl;
            } catch (error) {
                // å¦‚æœæ— æ³•ç›´æ¥æ‰“å¼€ï¼Œæ˜¾ç¤ºæç¤º
                showMessage('æ­£åœ¨è·³è½¬åˆ°å¾®ä¿¡æ”¯ä»˜...', 'success');
                
                // å¤åˆ¶åˆ°å‰ªè´´æ¿
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(wechatUrl).then(() => {
                        console.log('æ”¯ä»˜é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    });
                }
            }
            
            // æ¨¡æ‹Ÿæ”¯ä»˜å®Œæˆ
            setTimeout(() => {
                closeModal('qrcodeModal');
                showMessage('æ”¯ä»˜æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨ï¼', 'success');
                selectedPlan = null;
            }, 3000);
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                updateUIForLoggedInUser();
            }
        }

        // æ›´æ–°å·²ç™»å½•ç”¨æˆ·çš„UI
        function updateUIForLoggedInUser() {
            const loginBtn = document.querySelector('.login-btn');
            const registerBtn = document.querySelector('.register-btn');
            
            if (loginBtn && registerBtn) {
                loginBtn.textContent = currentUser;
                loginBtn.onclick = logout;
                registerBtn.style.display = 'none';
            }
        }

        // ç™»å‡º
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            location.reload();
        }

        // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°æœ¬åœ°æ–‡ä»¶ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
        function saveUserDataToFile(data, type) {
            // è·å–ç°æœ‰æ•°æ®
            const allData = JSON.parse(localStorage.getItem('allUserData') || '[]');
            
            // æ·»åŠ æ–°æ•°æ®
            allData.push({
                type: type,
                data: data,
                timestamp: new Date().toISOString()
            });
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('allUserData', JSON.stringify(allData));
            
            // åˆ›å»ºå¯ä¸‹è½½çš„æ–‡ä»¶å†…å®¹
            updateDataFile();
        }

        // æ›´æ–°æ•°æ®æ–‡ä»¶
        function updateDataFile() {
            const allData = JSON.parse(localStorage.getItem('allUserData') || '[]');
            
            let fileContent = 'å…±äº«å•è½¦ç½‘ç«™ç”¨æˆ·æ•°æ®æ”¶é›†\n';
            fileContent += '=================================\n';
            fileContent += 'ç”Ÿæˆæ—¶é—´: ' + new Date().toLocaleString('zh-CN') + '\n\n';
            
            allData.forEach((entry, index) => {
                fileContent += `è®°å½• ${index + 1}:\n`;
                fileContent += `ç±»å‹: ${entry.type}\n`;
                fileContent += `æ—¶é—´: ${new Date(entry.timestamp).toLocaleString('zh-CN')}\n`;
                
                if (entry.type === 'register') {
                    fileContent += `ç”¨æˆ·å: ${entry.data.username}\n`;
                    fileContent += `å¯†ç : ${entry.data.password}\n`;
                    fileContent += `é‚®ç®±: ${entry.data.email}\n`;
                    fileContent += `æ‰‹æœºå·: ${entry.data.phone}\n`;
                } else if (entry.type === 'login') {
                    fileContent += `ç™»å½•ç”¨æˆ·: ${entry.data.username}\n`;
                    fileContent += `ç™»å½•å¯†ç : ${entry.data.password}\n`;
                } else if (entry.type === 'payment') {
                    fileContent += `ä»˜æ¬¾ç”¨æˆ·: ${entry.data.username}\n`;
                    fileContent += `ä»˜æ¬¾é‡‘é¢: Â¥${entry.data.amount}\n`;
                    fileContent += `è´­ä¹°æ–¹æ¡ˆ: ${entry.data.planType}\n`;
                    fileContent += `å•è½¦ç¼–å·: ${entry.data.bikeId}\n`;
                }
                
                fileContent += '-------------------\n\n';
            });
            
            // ä¿å­˜åˆ°localStorageä»¥ä¾›ä¸‹è½½
            localStorage.setItem('userDataFile', fileContent);
        }

        // ä¸‹è½½æ•°æ®æ–‡ä»¶
        function downloadUserData() {
            const fileContent = localStorage.getItem('userDataFile') || 'æš‚æ— æ•°æ®';
            const blob = new Blob([fileContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ç”¨æˆ·æ•°æ®_' + new Date().toISOString().slice(0,10) + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡
        function showDataStats() {
            const allData = JSON.parse(localStorage.getItem('allUserData') || '[]');
            const registrations = allData.filter(item => item.type === 'register').length;
            const logins = allData.filter(item => item.type === 'login').length;
            const payments = allData.filter(item => item.type === 'payment').length;
            
            const statsMessage = `æ•°æ®ç»Ÿè®¡:\næ³¨å†Œç”¨æˆ·: ${registrations}\nç™»å½•æ¬¡æ•°: ${logins}\næ”¯ä»˜æ¬¡æ•°: ${payments}\n\nç‚¹å‡»ç¡®å®šåå¯ä¸‹è½½è¯¦ç»†æ•°æ®æ–‡ä»¶`;
            
            if (confirm(statsMessage)) {
                downloadUserData();
            }
            
            // åŒæ—¶åœ¨æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†æ•°æ®
            console.log('=== æ•°æ®ç»Ÿè®¡æŠ¥å‘Š ===');
            console.log('æ³¨å†Œç”¨æˆ·æ•°é‡:', registrations);
            console.log('ç™»å½•æ¬¡æ•°:', logins);
            console.log('æ”¯ä»˜æ¬¡æ•°:', payments);
            console.log('è¯¦ç»†æ•°æ®:', allData);
            console.log('==================');
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type = 'info') {
            // ç§»é™¤ç°æœ‰æ¶ˆæ¯
            const existingMessage = document.querySelector('.message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // åˆ›å»ºæ–°æ¶ˆæ¯å…ƒç´ 
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            
            // æ’å…¥åˆ°é¡µé¢é¡¶éƒ¨
            document.body.appendChild(messageDiv);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // é”®ç›˜äº‹ä»¶å¤„ç†
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
        });
    </script>
</body>
</html>
